# Copyright (c) 2026 plumiume
# SPDX-License-Identifier: <<spdxid>>
# License: MIT License (https://opensource.org/licenses/MIT)
# See LICENSE.txt for details.

# Docker Build Matrix Configuration
# 複数のCUDA/Python/ターゲットの組み合わせでビルドを実行するための設定

matrix:
  # CPUのみ + Python 3.13
  - cuda_version: null
    python_version: "3.13"
    cuda_tag: "cpu"
    ray_version: "2.54.0"
    targets:
      - name: simple-cpu
        tag: "simple-cpu-py313-torch2.8.0"
      - name: ray-cpu
        tag: "ray-cpu-py313-torch2.8.0-ray2.54.0"
      - name: marimo-cpu
        tag: "marimo-cpu-py313-torch2.8.0-ray2.54.0"

  # CPUのみ + Python 3.14
  - cuda_version: null
    python_version: "3.14"
    cuda_tag: "cpu"
    ray_version: "3.0.0.dev0"
    targets:
      - name: simple-cpu
        tag: "simple-cpu-py314-torch2.9.0"
      - name: ray-cpu
        tag: "ray-cpu-py314-torch2.9.0-ray3.0.0.dev0"
      - name: marimo-cpu
        tag: "marimo-cpu-py314-torch2.9.0-ray3.0.0.dev0"

  # CUDA 12.x系 + Python 3.13
  - cuda_version: "12.8.1"
    python_version: "3.13"
    cuda_tag: "cu128"
    ray_version: "2.54.0"
    targets:
      - name: "simple-devel"
        tag: "simple-devel-cu128-py313-torch2.8.0"
      - name: "simple-runtime"
        tag: "simple-runtime-cu128-py313-torch2.8.0"
      - name: "ray-devel"
        tag: "ray-devel-cu128-py313-torch2.8.0-ray2.54.0"
      - name: "ray-runtime"
        tag: "ray-runtime-cu128-py313-torch2.8.0-ray2.54.0"
      - name: "marimo-devel"
        tag: "marimo-devel-cu128-py313-torch2.8.0-ray2.54.0"
      - name: "marimo-runtime"
        tag: "marimo-runtime-cu128-py313-torch2.8.0-ray2.54.0"

  # CUDA 13.x系 + Python 3.13
  - cuda_version: "13.1.1"
    python_version: "3.13"
    cuda_tag: "cu131"
    ray_version: "2.54.0"
    targets:
      - name: "simple-devel"
        tag: "simple-devel-cu131-py313-torch2.8.0"
      - name: "simple-runtime"
        tag: "simple-runtime-cu131-py313-torch2.8.0"
      - name: "ray-devel"
        tag: "ray-devel-cu131-py313-torch2.8.0-ray2.54.0"
      - name: "ray-runtime"
        tag: "ray-runtime-cu131-py313-torch2.8.0-ray2.54.0"
      - name: "marimo-devel"
        tag: "marimo-devel-cu131-py313-torch2.8.0-ray2.54.0"
      - name: "marimo-runtime"
        tag: "marimo-runtime-cu131-py313-torch2.8.0-ray2.54.0"
  
  # CUDA 13.x系 + Python 3.14
  - cuda_version: "13.1.1"
    python_version: "3.14"
    cuda_tag: "cu130"
    ray_version: "3.0.0.dev0"
    targets:
      - name: "simple-builder"
        tag: "simple-builder-cu130-py314-torch2.9.0"
      - name: "simple-devel"
        tag: "simple-devel-cu130-py314-torch2.9.0"
      - name: "simple-runtime"
        tag: "simple-runtime-cu130-py314-torch2.9.0"
      - name: "ray-builder"
        tag: "ray-builder-cu130-py314-torch2.9.0-ray3.0.0.dev0"
      - name: "ray-devel"
        tag: "ray-devel-cu130-py314-torch2.9.0-ray3.0.0.dev0"
      - name: "ray-runtime"
        tag: "ray-runtime-cu130-py314-torch2.9.0-ray3.0.0.dev0"
      - name: "marimo-builder"
        tag: "marimo-builder-cu130-py314-torch2.9.0-ray3.0.0.dev0"
      - name: "marimo-devel"
        tag: "marimo-devel-cu130-py314-torch2.9.0-ray3.0.0.dev0"
      - name: "marimo-runtime"
        tag: "marimo-runtime-cu130-py314-torch2.9.0-ray3.0.0.dev0"
  
  # CUDA 12.x系 + Python 3.14
  - cuda_version: "12.8.1"
    python_version: "3.14"
    cuda_tag: "cu128"
    ray_version: "3.0.0.dev0"
    targets:
      - name: "simple-builder"
        tag: "simple-builder-cu128-py314-torch2.8.0"
      - name: "simple-devel"
        tag: "simple-devel-cu128-py314-torch2.8.0"
      - name: "simple-runtime"
        tag: "simple-runtime-cu128-py314-torch2.8.0"
      - name: "ray-builder"
        tag: "ray-builder-cu128-py314-torch2.8.0-ray3.0.0.dev0"
      - name: "ray-devel"
        tag: "ray-devel-cu128-py314-torch2.8.0-ray3.0.0.dev0"
      - name: "ray-runtime"
        tag: "ray-runtime-cu128-py314-torch2.8.0-ray3.0.0.dev0"
      - name: "marimo-builder"
        tag: "marimo-builder-cu128-py314-torch2.8.0-ray3.0.0.dev0"
      - name: "marimo-devel"
        tag: "marimo-devel-cu128-py314-torch2.8.0-ray3.0.0.dev0"
      - name: "marimo-runtime"
        tag: "marimo-runtime-cu128-py314-torch2.8.0-ray3.0.0.dev0"

# ビルド設定
build_options:
  platform: "linux/amd64"
  image_prefix: "plumiiume/cslr-exp-platform"
  
# 最小構成（テスト用）
minimal_build:
  cuda_version: "12.8.1"
  python_version: "3.13"
  cuda_tag: "cu128"
  ray_version: "2.54.0"
  target: "marimo-runtime"
  tag: "marimo-runtime-cu128-py313-torch2.8.0-ray2.54.0"
